================================================================================
                    智谱AI提取规则修改 - 代码位置图
================================================================================

文件：evaluate_checkpoints_with_claude_v2.py
================================================================================

主函数 main()
│
├─ [273-290行] 配置读取
│   └─ API密钥从 evaluation_config.yaml 读取
│
├─ [292-308行] PDF文本提取
│   └─ extract_pdf_text(pdf_path, max_chars=15000)
│       └─ ⚠️ 可修改：max_chars 控制输入文本长度
│
├─ [310-349行] ⭐⭐⭐⭐⭐ 核心Prompt定义 ⭐⭐⭐⭐⭐
│   │
│   ├─ [311行]   角色定义
│   │   └─ "你是一个招标文件评审专家..."
│   │
│   ├─ [313-316行] 输入文本
│   │   └─ document_text (前15000字符)
│   │
│   ├─ [318-332行] ⭐ 输出格式定义 ⭐
│   │   │   ┌───────────────────────────────────────┐
│   │   │   │ "checkpoints": [{                    │
│   │   │   │   "id": "唯一编号",                   │
│   │   │   │   "category": "分类名称", ⭐          │  ← 修改输出字段
│   │   │   │   "label": "简短描述",                │
│   │   │   │   "content": "详细说明",              │
│   │   │   │   "importance": "高/中/低",           │
│   │   │   │   "score": "分值"                    │
│   │   │   │ }]                                    │
│   │   │   └───────────────────────────────────────┘
│   │
│   ├─ [334-340行] ⭐⭐⭐ 提取要求 ⭐⭐⭐
│   │   │
│   │   ├─ [335行] ⭐ 粒度控制 ⭐
│   │   │   └─ "细粒度提取：尽量保持原文具体表述"
│   │   │       → 改为："超细粒度提取：提取每个评分项"
│   │   │
│   │   ├─ [336行] 表述控制
│   │   │   └─ "保留原文术语：使用原始术语和分类名称"
│   │   │
│   │   ├─ [337行] 范围控制
│   │   │   └─ "提取所有评分项：形式、资格、技术、商务"
│   │   │
│   │   ├─ [338行] 字段控制
│   │   │   └─ "包含分值信息：如果有分值请标注"
│   │   │
│   │   └─ [339行] ⭐⭐ 数量控制 ⭐⭐
│   │       └─ "数量控制：提取主要检查点（10-20个）"
│   │           → 改为："（20-30个）" ⭐ 最常用修改
│   │
│   └─ [342-347行] ⭐⭐⭐ 分类参考 ⭐⭐⭐
│       └─ "- 封面检查、签字盖章"
│           "- 报价唯一性、资格要求"
│           "- 人员要求、企业业绩、企业资质"  ⭐ 最常用修改
│           "- 技术方案、服务承诺"
│
├─ [351行] API调用
│   └─ call_zhipuai_api_with_retry(api_key, prompt)
│       └─ 内部参数（第66-76行）：
│           ├─ model="glm-4.7"          ⭐ 可修改模型
│           ├─ temperature=0.1          ⭐ 可修改温度
│           └─ max_tokens=8000          ⭐ 可修改长度
│
├─ [357-363行] 结果解析
│   └─ parse_zhipuai_checkpoints(response)
│
├─ [379行] 对比分析
│   └─ compare_checkpoints_improved(...)
│       └─ 第192行：threshold = 0.3     ⭐ 可修改阈值
│
└─ [383-398行] 保存结果
    └─ 输出到：./test_data/evaluation/results/claude_comparison_v2_*.json


================================================================================
                              快速修改指南
================================================================================

🎯 最常用修改（2个位置）：

1. [第339行] 修改提取数量
   原来：5. **数量控制**：提取主要检查点（10-20个）
   改为：5. **数量控制**：提取所有检查点（20-30个）

2. [第342-347行] 修改分类参考
   原来：- 封面检查、签字盖章
         - 报价唯一性、资格要求
         - 人员要求、企业业绩、企业资质
   改为：- 使用你的招标文件中的分类名称


🎨 进阶修改（4个位置）：

3. [第335行] 修改提取粒度
   细粒度 → 超细粒度（提取每个评分项）

4. [第336行] 修改表述要求
   保留原文术语 → 完全保持原文，不要改写

5. [第318-329行] 修改输出格式
   添加新字段：page_number, is_veto, check_points等

6. [第66行] 修改模型选择
   glm-4.7 → glm-4-plus（更强的模型）


🔧 高级修改（3个位置）：

7. [第310-349行] 添加Few-Shot示例
   在Prompt开头添加具体的提取示例

8. [第76行] 调整温度参数
   temperature=0.1 → temperature=0.0（更确定）

9. [第192行] 调整相似度阈值
   threshold=0.3 → threshold=0.25（更宽松）


================================================================================
                              修改流程
================================================================================

步骤1：打开文件
  code evaluate_checkpoints_with_claude_v2.py
  或
  vim evaluate_checkpoints_with_claude_v2.py

步骤2：查找位置
  搜索：# 3. 改进的Prompt
  或直接跳转：:310

步骤3：修改内容
  根据上面的"最常用修改"修改对应行

步骤4：保存文件
  Ctrl+S

步骤5：测试效果
  python evaluate_checkpoints_with_claude_v2.py

步骤6：查看结果
  python compare_results.py


================================================================================
                            预期效果
================================================================================

修改前：
  提取数量：12个
  覆盖率：0%
  召回率：0%

修改后（使用推荐修改）：
  提取数量：20-30个
  覆盖率：60-80%
  召回率：50-70%


================================================================================
                          立即开始
================================================================================

最快方式：复制"推荐修改"版本，替换第310-349行！

推荐修改版本见：提取规则快速修改.md

================================================================================
