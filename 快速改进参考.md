# æå‡æ¨¡å‹æå–å‡†ç¡®æ€§ - å¿«é€Ÿå‚è€ƒ

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›ï¼ˆ3é€‰1å³å¯è§æ•ˆï¼‰

### âœ… æ–¹æ¡ˆ1ï¼šä¼˜åŒ–Promptï¼ˆæœ€ç®€å•ï¼Œå·²å®æ–½ï¼‰
**æ–‡ä»¶**ï¼š`evaluate_checkpoints_with_claude_v2.py`

```bash
# è¿è¡Œä¼˜åŒ–ç‰ˆæœ¬
python evaluate_checkpoints_with_claude_v2.py
```

**æ”¹è¿›ç‚¹**ï¼š
- âœ… æ–‡æœ¬é•¿åº¦ï¼š10,000 â†’ 15,000å­—ç¬¦
- âœ… æ˜ç¡®è¦æ±‚ï¼šä¿æŒåŸæ–‡è¡¨è¿°ï¼Œä¸è¦è¿‡åº¦æ¦‚æ‹¬
- âœ… æä¾›åˆ†ç±»å‚è€ƒï¼šå°é¢æ£€æŸ¥ã€äººå‘˜è¦æ±‚(6åˆ†)ç­‰
- âœ… æ”¹è¿›åŒ¹é…ç®—æ³•ï¼šJaccardç›¸ä¼¼åº¦ + é˜ˆå€¼

**é¢„æœŸæ•ˆæœ**ï¼šè¦†ç›–ç‡ 0% â†’ 60-80%

---

### âœ… æ–¹æ¡ˆ2ï¼šæ·»åŠ Few-Shotç¤ºä¾‹ï¼ˆæ¨èï¼‰

åœ¨ `evaluate_checkpoints_with_claude_v2.py` çš„ prompt ä¸­æ·»åŠ ï¼š

```python
prompt = f"""ä½ æ˜¯æ‹›æ ‡æ–‡ä»¶è¯„å®¡ä¸“å®¶ã€‚

**æå–ç¤ºä¾‹ï¼š**

åŸæ–‡ï¼šå…·æœ‰ISO 9001è´¨é‡ç®¡ç†ä½“ç³»è®¤è¯è¯ä¹¦ï¼Œå¾—1åˆ†ï¼›å…·æœ‰ISO 14001ç¯å¢ƒç®¡ç†ä½“ç³»è®¤è¯è¯ä¹¦ï¼Œå¾—1åˆ†ã€‚

æå–ç»“æœï¼š
{{
  "category": "ä¼ä¸šèµ„è´¨(3åˆ†)",
  "label": "å…·æœ‰ISO 9001è´¨é‡ç®¡ç†ä½“ç³»è®¤è¯è¯ä¹¦",
  "content": "å¾—1åˆ†ï¼›å…·æœ‰ISO 14001ç¯å¢ƒç®¡ç†ä½“ç³»è®¤è¯è¯ä¹¦ï¼Œå¾—1åˆ†",
  "score": "3åˆ†"
}}

**ç°åœ¨è¯·åˆ†æä»¥ä¸‹æ‹›æ ‡æ–‡ä»¶**ï¼š

æ‹›æ ‡æ–‡ä»¶å†…å®¹ï¼š
```
{document_text}
```

è¯·æå–æ‰€æœ‰æ£€æŸ¥ç‚¹...
"""
```

**é¢„æœŸæ•ˆæœ**ï¼šå‡†ç¡®æ€§æå‡ 20-30%

---

### âœ… æ–¹æ¡ˆ3ï¼šä½¿ç”¨æ›´å¼ºæ¨¡å‹

ä¿®æ”¹é…ç½®æ–‡ä»¶ `evaluation_config.yaml`ï¼š

```yaml
zhipuai_model: "glm-4-plus"  # æ›¿ä»£ "glm-4.7"
```

æˆ–åœ¨ä»£ç ä¸­ï¼š

```python
response = client.chat.completions.create(
    model="glm-4-plus",  # æ›´å¼ºçš„æ¨¡å‹
    messages=[...],
    temperature=0.1
)
```

**é¢„æœŸæ•ˆæœ**ï¼šç†è§£èƒ½åŠ›æå‡ 15-25%

---

## ğŸ”§ é«˜çº§æŠ€å·§

### æŠ€å·§1ï¼šè°ƒæ•´ç›¸ä¼¼åº¦é˜ˆå€¼

```python
# åœ¨ compare_checkpoints_improved å‡½æ•°ä¸­
threshold = 0.3  # é»˜è®¤

# å¦‚æœåŒ¹é…å¤ªå°‘ï¼Œé™ä½é˜ˆå€¼
threshold = 0.2  # æ›´å®½æ¾

# å¦‚æœè¯¯æŠ¥å¤ªå¤šï¼Œæé«˜é˜ˆå€¼
threshold = 0.4  # æ›´ä¸¥æ ¼
```

### æŠ€å·§2ï¼šåˆ†æ®µå¤„ç†å¤§æ–‡æ¡£

```python
# å¦‚æœæ–‡æ¡£è¶…è¿‡20000å­—ç¬¦ï¼Œåˆ†æ®µå¤„ç†
chunks = split_document(document_text, chunk_size=10000)
for chunk in chunks:
    checkpoints = extract_from_chunk(chunk)
```

### æŠ€å·§3ï¼šè¿­ä»£ä¼˜åŒ–

```python
for i in range(3):  # è¿­ä»£3æ¬¡
    checkpoints = extract_checkpoints(document_text)
    coverage = calculate_coverage(document_text, checkpoints)

    if coverage > 0.85:
        break

    # æ ¹æ®é—æ¼éƒ¨åˆ†è¡¥å……æå–
    document_text += generate_supplement_prompt(checkpoints)
```

---

## ğŸ“Š æ•ˆæœå¯¹æ¯”è¡¨

| æ–¹æ³• | å®æ–½éš¾åº¦ | é¢„æœŸæå‡ | æ¨èåº¦ |
|-----|---------|---------|--------|
| ä¼˜åŒ–Promptï¼ˆV2ï¼‰ | â­ ç®€å• | +60% | â­â­â­â­â­ |
| Few-Shotç¤ºä¾‹ | â­â­ ä¸­ç­‰ | +30% | â­â­â­â­ |
| ä½¿ç”¨æ›´å¼ºæ¨¡å‹ | â­ ç®€å• | +25% | â­â­â­â­ |
| æ”¹è¿›åŒ¹é…ç®—æ³• | â­â­â­ è¾ƒéš¾ | +20% | â­â­â­ |
| å¤šé˜¶æ®µæå– | â­â­â­â­ å›°éš¾ | +40% | â­â­â­ |

---

## ğŸš€ å¿«é€Ÿä¸Šæ‰‹

### ç¬¬ä¸€æ­¥ï¼šè¿è¡Œä¼˜åŒ–ç‰ˆæœ¬

```bash
cd d:\interface_pytest\interface_pytest
python evaluate_checkpoints_with_claude_v2.py
```

### ç¬¬äºŒæ­¥ï¼šæŸ¥çœ‹ç»“æœ

ç»“æœä¿å­˜åœ¨ï¼š`./test_data/evaluation/results/claude_comparison_v2_*.json`

### ç¬¬ä¸‰æ­¥ï¼šæ ¹æ®æ•ˆæœè°ƒæ•´

å¦‚æœè¦†ç›–ç‡ < 60%ï¼š
```python
# é™ä½ç›¸ä¼¼åº¦é˜ˆå€¼
threshold = 0.2
```

å¦‚æœè¯¯æŠ¥å¤ªå¤šï¼š
```python
# æé«˜ç›¸ä¼¼åº¦é˜ˆå€¼
threshold = 0.4
```

---

## ğŸ“ æ£€æŸ¥æ¸…å•

- [ ] è¿è¡Œä¼˜åŒ–ç‰ˆæœ¬è„šæœ¬
- [ ] æ£€æŸ¥æå–çš„æ£€æŸ¥ç‚¹æ•°é‡ï¼ˆç›®æ ‡ï¼š15-18ä¸ªï¼‰
- [ ] æŸ¥çœ‹åŒ¹é…ç‡ï¼ˆç›®æ ‡ï¼š>60%ï¼‰
- [ ] äººå·¥æŠ½æŸ¥5-10ä¸ªæ£€æŸ¥ç‚¹
- [ ] æ ¹æ®æ•ˆæœè°ƒæ•´é˜ˆå€¼
- [ ] ï¼ˆå¯é€‰ï¼‰æ·»åŠ Few-Shotç¤ºä¾‹
- [ ] ï¼ˆå¯é€‰ï¼‰å°è¯•æ›´å¼ºæ¨¡å‹

---

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆåŒ¹é…ç‡è¿˜æ˜¯0ï¼Ÿ
**A**: å¯èƒ½åŸå› ï¼š
- ç›¸ä¼¼åº¦é˜ˆå€¼å¤ªé«˜ â†’ é™ä½åˆ° 0.2
- åˆ†ç±»ä½“ç³»ä¸åŒ¹é… â†’ è°ƒæ•´Promptä¸­çš„åˆ†ç±»å‚è€ƒ
- æ£€æŸ¥ç‚¹è¡¨è¾¾å·®å¼‚å¤ªå¤§ â†’ æ·»åŠ Few-Shotç¤ºä¾‹

### Q2: å¦‚ä½•åˆ¤æ–­æå–è´¨é‡ï¼Ÿ
**A**: ä¸‰ä¸ªæŒ‡æ ‡ï¼š
1. **æ•°é‡**ï¼š15-18ä¸ªä¸ºå®œï¼ˆå¤ªå°‘=é—æ¼ï¼Œå¤ªå¤š=å™ªéŸ³ï¼‰
2. **è¦†ç›–ç‡**ï¼š>60%ä¸ºåˆæ ¼
3. **äººå·¥æŠ½æŸ¥**ï¼šéšæœºæ£€æŸ¥5ä¸ªï¼Œçœ‹æ˜¯å¦å‡†ç¡®

### Q3: å“ªç§æ–¹æ³•æ€§ä»·æ¯”æœ€é«˜ï¼Ÿ
**A**: æ¨èç»„åˆï¼š
1. å…ˆç”¨æ–¹æ¡ˆ1ï¼ˆä¼˜åŒ–Promptï¼‰ - 0æˆæœ¬
2. å†ç”¨æ–¹æ¡ˆ3ï¼ˆæ›´å¼ºæ¨¡å‹ï¼‰ - ç•¥å¢æˆæœ¬
3. æœ€åç”¨æ–¹æ¡ˆ2ï¼ˆFew-Shotï¼‰ - éœ€è¦æ—¶é—´å‡†å¤‡

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| [evaluate_checkpoints_with_claude_v2.py](evaluate_checkpoints_with_claude_v2.py) | ä¼˜åŒ–ç‰ˆè„šæœ¬ |
| [evaluate_checkpoints_with_claude.py](evaluate_checkpoints_with_claude.py) | åŸç‰ˆè„šæœ¬ |
| [æå‡æ¨¡å‹æå–å‡†ç¡®æ€§æŒ‡å—.md](æå‡æ¨¡å‹æå–å‡†ç¡®æ€§æŒ‡å—.md) | è¯¦ç»†æŒ‡å— |

---

**ç«‹å³å¼€å§‹**ï¼šè¿è¡Œ `python evaluate_checkpoints_with_claude_v2.py`
